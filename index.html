<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Railway Ticket Booking — Demo</title>
  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --primary:#0b5ed7;
      --muted:#6b7280;
      --success:#198754;
      --danger:#dc3545;
      --glass: rgba(255,255,255,0.75);
      --radius:12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: linear-gradient(180deg,#eef4ff 0%,var(--bg) 100%);
      padding:24px;
      color:#0f172a;
    }

    .container{max-width:1100px;margin:0 auto;}
    header{
      display:flex;align-items:center;gap:16px;margin-bottom:18px;
    }
    .logo{
      background:var(--card);border-radius:10px;padding:10px 14px;box-shadow:0 6px 18px rgba(11,78,215,0.08);display:flex;align-items:center;gap:10px;
    }
    .logo h1{margin:0;font-size:18px;color:var(--primary)}
    p.tag{margin:0;color:var(--muted);font-size:13px}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:0 6px 18px rgba(15,23,42,0.06);
    }

    /* Search */
    .search-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .form-row{display:flex;flex-direction:column}
    label{font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="date"], select{
      padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;background:linear-gradient(#fff,#fbfdff);
    }
    .actions{display:flex;gap:8px;align-items:center}
    button.primary{
      background:var(--primary);color:white;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;
    }
    button.ghost{background:transparent;border:1px solid #dbe6ff;color:var(--primary);padding:10px 14px;border-radius:10px;cursor:pointer}
    button:disabled{opacity:0.6;cursor:not-allowed}

    main{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:16px}
    /* Train list */
    .train-list{display:flex;flex-direction:column;gap:12px}
    .train{
      display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;border:1px solid #eef2ff;background:linear-gradient(#fff,#fbfdff);
    }
    .train .meta{display:flex;gap:12px;align-items:center}
    .station{font-weight:700;font-size:16px}
    .small{font-size:13px;color:var(--muted)}
    .price{font-weight:700;color:#0b5ed7}
    .book-btn{background:linear-gradient(90deg,#0b5ed7,#2563eb);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}

    /* Sidebar booking summary */
    .sidebar .summary{display:flex;flex-direction:column;gap:8px}
    .summary .row{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass)}
    .muted{color:var(--muted)}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:60}
    .modal{width:100%;max-width:720px;background:var(--card);border-radius:14px;padding:18px;box-shadow:0 20px 50px rgba(2,6,23,0.3)}
    .modal .seats{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin:12px 0}
    .seat{padding:8px;border-radius:6px;text-align:center;border:1px solid #e5e7eb;cursor:pointer}
    .seat.available{background:#f8fafc}
    .seat.selected{background:#0b5ed7;color:white;border-color:#0b5ed7}
    .seat.booked{background:#f8d7da;color:#721c24;border-color:#f5c2c7;cursor:not-allowed}

    /* responsive */
    @media (max-width:980px){
      .search-grid{grid-template-columns:repeat(2,1fr)}
      main{grid-template-columns:1fr}
      .modal{max-width:580px}
    }
    @media (max-width:520px){
      .search-grid{grid-template-columns:1fr}
      header{flex-direction:column;align-items:flex-start;gap:8px}
    }

    .note{font-size:13px;color:var(--muted)}
    .result-empty{padding:28px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><rect width="24" height="24" rx="8" fill="#e7f0ff"/><path d="M6 12h12" stroke="#0b5ed7" stroke-width="1.5" stroke-linecap="round"/><circle cx="8" cy="15" r="1.5" fill="#0b5ed7"/><circle cx="16" cy="15" r="1.5" fill="#0b5ed7"/></svg>
        <div>
          <h1>RailBook</h1>
          <p class="tag">Ticket booking demo — frontend only</p>
        </div>
      </div>
    </header>

    <section class="card">
      <form id="searchForm" class="search-grid" onsubmit="return false;">
        <div class="form-row">
          <label>From</label>
          <input id="from" type="text" placeholder="e.g. New Delhi (NDLS)" value="New Delhi">
        </div>
        <div class="form-row">
          <label>To</label>
          <input id="to" type="text" placeholder="e.g. Mumbai Central (BCT)" value="Mumbai Central">
        </div>
        <div class="form-row">
          <label>Journey Date</label>
          <input id="date" type="date">
        </div>
        <div class="form-row">
          <label>Class / Passengers</label>
          <div style="display:flex;gap:8px">
            <select id="class">
              <option>1A</option><option>2A</option><option>3A</option><option>SL</option>
            </select>
            <select id="pax">
              <option value="1">1 passenger</option>
              <option value="2">2 passengers</option>
              <option value="3">3 passengers</option>
              <option value="4">4 passengers</option>
            </select>
          </div>
        </div>

        <div style="grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <div class="note">This is a static demo. No real booking or payments are made.</div>
          <div class="actions">
            <button type="button" class="ghost" id="swapBtn" title="Swap from/to">Swap</button>
            <button class="primary" id="searchBtn">Search Trains</button>
          </div>
        </div>
      </form>
    </section>

    <main>
      <section>
        <div class="card">
          <h2 style="margin:0 0 8px 0">Available Trains</h2>
          <div id="results" class="train-list">
            <!-- train items injected here -->
          </div>
        </div>
      </section>

      <aside class="sidebar">
        <div class="card">
          <h3 style="margin:0 0 8px 0">Booking Summary</h3>
          <div class="summary" id="summary">
            <div class="row"><div class="muted">Trip</div><div>—</div></div>
            <div class="row"><div class="muted">Date</div><div>—</div></div>
            <div class="row"><div class="muted">Class & Pax</div><div>—</div></div>
            <div class="row"><div class="muted">Selected Train</div><div>—</div></div>
            <div style="text-align:center;margin-top:12px">
              <button id="myBookingsBtn" class="ghost">View My Bookings</button>
            </div>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Modal for seat selection -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">Select Seats</h3>
        <button id="closeModal" class="ghost">Close</button>
      </div>

      <div style="margin-top:8px">
        <div class="small">Train: <strong id="modalTrainName"></strong></div>
        <div class="small">Class: <strong id="modalClass"></strong></div>
      </div>

      <div class="seats" id="seatsGrid" aria-live="polite">
        <!-- seats -->
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="confirmSeat" class="primary" disabled>Confirm & Book</button>
      </div>
    </div>
  </div>

  <!-- Simple modal for bookings -->
  <div id="bookingsModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal">
      <h3>My Bookings</h3>
      <div id="bookingsList" style="margin-top:8px"></div>
      <div style="text-align:right;margin-top:12px">
        <button id="closeBookings" class="ghost">Close</button>
      </div>
    </div>
  </div>

  <script>
    // --- Sample train data (in real app this comes from server) ---
    const sampleTrains = [
      {id: '12627', name:'Shiv Ganga Express', from:'New Delhi', to:'Mumbai Central', dep:'16:10', arr:'08:30', duration:'16h 20m', price:{'1A':4500,'2A':3200,'3A':2200,'SL':800}},
      {id: '12951', name:'Rajdhani Express', from:'New Delhi', to:'Mumbai Central', dep:'20:05', arr:'10:45', duration:'14h 40m', price:{'1A':5500,'2A':4200,'3A':3000,'SL':900}},
      {id: '11077', name:'Lokmanya Tilak SF', from:'New Delhi', to:'Mumbai Central', dep:'22:00', arr:'11:50', duration:'13h 50m', price:{'1A':5000,'2A':3800,'3A':2700,'SL':950}},
      {id: '09005', name:'Superfast Passenger', from:'New Delhi', to:'Mumbai Central', dep:'06:00', arr:'23:55', duration:'17h 55m', price:{'1A':3900,'2A':2700,'3A':1800,'SL':650}}
    ];

    // Local state
    let selectedTrain = null;
    let selectedClass = '3A';
    let pax = 1;
    let journeyDate = null;

    // DOM refs
    const resultsEl = document.getElementById('results');
    const summaryEl = document.getElementById('summary');
    const modal = document.getElementById('modal');
    const bookingsModal = document.getElementById('bookingsModal');

    // init date to tomorrow by default
    (function init(){
      const dt = new Date();
      dt.setDate(dt.getDate() + 1);
      document.getElementById('date').value = dt.toISOString().slice(0,10);
    })();

    // swap
    document.getElementById('swapBtn').addEventListener('click',()=>{
      const a=document.getElementById('from'), b=document.getElementById('to');
      [a.value,b.value] = [b.value,a.value];
    });

    document.getElementById('searchBtn').addEventListener('click', doSearch);

    // search logic (filter sampleTrains by from/to)
    function doSearch(){
      const from = document.getElementById('from').value.trim();
      const to = document.getElementById('to').value.trim();
      journeyDate = document.getElementById('date').value;
      selectedClass = document.getElementById('class').value;
      pax = parseInt(document.getElementById('pax').value,10);

      const filtered = sampleTrains.filter(t => (from==='' || t.from.toLowerCase().includes(from.toLowerCase())) && (to==='' || t.to.toLowerCase().includes(to.toLowerCase())));

      renderResults(filtered);
      updateSummary();
    }

    // render results
    function renderResults(list){
      resultsEl.innerHTML='';
      if(list.length===0){
        resultsEl.innerHTML = '<div class="result-empty card">Koi train available nahin hai. Try changing stations or date.</div>';
        return;
      }
      list.forEach(t=>{
        const tr = document.createElement('div');
        tr.className='train';
        tr.innerHTML = `
          <div class="meta">
            <div>
              <div class="station">${t.name} <span class="small">(${t.id})</span></div>
              <div class="small">${t.from} → ${t.to} • ${t.duration}</div>
            </div>
          </div>
          <div style="text-align:right">
            <div class="price">₹${t.price[selectedClass] || t.price['3A']}</div>
            <div class="small">${t.dep} — ${t.arr}</div>
            <div style="margin-top:8px">
              <button class="book-btn" onclick="openSeatModal('${t.id}')">Book</button>
            </div>
          </div>
        `;
        resultsEl.appendChild(tr);
      });
    }

    // open seat modal
    function openSeatModal(trainId){
      selectedTrain = sampleTrains.find(x=>x.id===trainId);
      if(!selectedTrain) return alert('Train not found.');
      document.getElementById('modalTrainName').textContent = `${selectedTrain.name} (${selectedTrain.id})`;
      document.getElementById('modalClass').textContent = document.getElementById('class').value;
      fillSeats(); // create seats
      modal.style.display='flex';
      modal.setAttribute('aria-hidden','false');
      document.getElementById('confirmSeat').disabled = true;
    }

    // create seats grid (simulate booked seats)
    function fillSeats(){
      const seatsGrid = document.getElementById('seatsGrid');
      seatsGrid.innerHTML='';
      // simulate some booked seats randomly but deterministic using train id
      const seeded = Number(selectedTrain.id.split('').reduce((a,c)=>a+c.charCodeAt(0),0));
      const rng = mulberry32(seeded);
      const booked = new Set();
      for(let i=0;i<18;i++){
        if(rng() > 0.7) booked.add(i+1);
      }
      for(let i=1;i<=30;i++){
        const div = document.createElement('div');
        div.className = 'seat ' + (booked.has(i)?'booked':'available');
        div.textContent = i;
        if(!booked.has(i)){
          div.addEventListener('click', ()=>{
            toggleSeat(div);
          });
        }
        seatsGrid.appendChild(div);
      }
    }

    // seat toggle
    function toggleSeat(el){
      const already = document.querySelectorAll('.seat.selected').length;
      if(el.classList.contains('selected')){
        el.classList.remove('selected');
      } else {
        if(already >= pax){
          alert('Aap ' + pax + ' passengers ke liye seat select kar sakte hain.');
          return;
        }
        el.classList.add('selected');
      }
      document.getElementById('confirmSeat').disabled = document.querySelectorAll('.seat.selected').length !== pax;
    }

    document.getElementById('closeModal').addEventListener('click', closeModal);
    function closeModal(){
      modal.style.display='none';
      modal.setAttribute('aria-hidden','true');
      document.getElementById('seatsGrid').innerHTML='';
    }

    // confirm booking -> open a small passenger & contact form, for demo we'll save booking to localStorage
    document.getElementById('confirmSeat').addEventListener('click', ()=>{
      const seats = Array.from(document.querySelectorAll('.seat.selected')).map(el=>el.textContent);
      if(seats.length !== pax) return alert('Please select ' + pax + ' seats.');
      // ask passenger names quickly
      const names = [];
      for(let i=1;i<=pax;i++){
        const n = prompt('Enter name for passenger ' + i + ':');
        if(!n) return alert('Booking cancelled — name required.');
        names.push(n.trim());
      }
      const contact = prompt('Enter contact mobile/email for ticket confirmation:');
      if(!contact) return alert('Booking cancelled — contact required.');

      // build booking object
      const booking = {
        id: 'BK' + Date.now(),
        trainId: selectedTrain.id,
        trainName: selectedTrain.name,
        from: document.getElementById('from').value,
        to: document.getElementById('to').value,
        date: document.getElementById('date').value,
        cls: document.getElementById('class').value,
        pax: pax,
        seats: seats,
        names: names,
        contact: contact,
        amount: (selectedTrain.price[document.getElementById('class').value] || selectedTrain.price['3A'])*pax
      };

      saveBooking(booking);
      closeModal();
      alert('Booking confirmed! Booking ID: ' + booking.id + '\\nAmount: ₹' + booking.amount);
      updateSummaryWithBooking(booking);
    });

    // localStorage bookings
    function saveBooking(b){
      const arr = JSON.parse(localStorage.getItem('railbook_bookings')||'[]');
      arr.push(b);
      localStorage.setItem('railbook_bookings', JSON.stringify(arr));
    }

    // view bookings
    document.getElementById('myBookingsBtn').addEventListener('click', showBookings);
    document.getElementById('closeBookings').addEventListener('click', ()=>{bookingsModal.style.display='none';bookingsModal.setAttribute('aria-hidden','true')});

    function showBookings(){
      const arr = JSON.parse(localStorage.getItem('railbook_bookings')||'[]');
      const container = document.getElementById('bookingsList');
      container.innerHTML='';
      if(arr.length===0){
        container.innerHTML='<div class="small">Koi booking saved nahi hai.</div>';
      } else {
        arr.slice().reverse().forEach(b=>{
          const div = document.createElement('div');
          div.style.padding='8px 0';div.style.borderBottom='1px dashed #e6eefc';
          div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${b.trainName} (${b.trainId})</strong><div class="small">${b.from} → ${b.to} • ${b.date}</div></div><div style="text-align:right"><div>₹${b.amount}</div><div class="small">${b.pax} pax</div></div></div>
          <div class="small" style="margin-top:6px">Seats: ${b.seats.join(', ')} • Booking ID: <strong>${b.id}</strong></div>`;
          container.appendChild(div);
        });
      }
      bookingsModal.style.display='flex';
      bookingsModal.setAttribute('aria-hidden','false');
    }

    // update booking summary on sidebar
    function updateSummary(){
      const from = document.getElementById('from').value || '—';
      const to = document.getElementById('to').value || '—';
      const date = document.getElementById('date').value || '—';
      const cls = document.getElementById('class').value;
      const paxText = document.getElementById('pax').value + ' pax';
      const trainText = selectedTrain ? selectedTrain.name + ' ('+selectedTrain.id+')' : '—';

      summaryEl.innerHTML = `
        <div class="row"><div class="muted">Trip</div><div>${from} → ${to}</div></div>
        <div class="row"><div class="muted">Date</div><div>${date}</div></div>
        <div class="row"><div class="muted">Class & Pax</div><div>${cls} • ${paxText}</div></div>
        <div class="row"><div class="muted">Selected Train</div><div>${trainText}</div></div>
        <div style="text-align:center;margin-top:12px">
          <button id="myBookingsBtn2" class="ghost">View My Bookings</button>
        </div>
      `;
      // rebind new button
      const mb = document.getElementById('myBookingsBtn2');
      if(mb) mb.addEventListener('click', showBookings);
    }

    function updateSummaryWithBooking(b){
      // show last booking in summary
      summaryEl.innerHTML = `
        <div class="row"><div class="muted">Last Booking</div><div>${b.trainName} (${b.trainId})</div></div>
        <div class="row"><div class="muted">Date</div><div>${b.date}</div></div>
        <div class="row"><div class="muted">Class & Pax</div><div>${b.cls} • ${b.pax} pax</div></div>
        <div class="row"><div class="muted">Seats</div><div>${b.seats.join(', ')}</div></div>
        <div style="text-align:center;margin-top:12px">
          <button id="myBookingsBtn3" class="ghost">View All Bookings</button>
        </div>
      `;
      const mb = document.getElementById('myBookingsBtn3');
      if(mb) mb.addEventListener('click', showBookings);
    }

    // tiny deterministic RNG for demo
    function mulberry32(a) {
      return function() {
        var t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }

    // initial search on load
    doSearch();

    // accessibility: close modal on ESC
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape'){
        if(modal.style.display==='flex') closeModal();
        if(bookingsModal.style.display==='flex'){bookingsModal.style.display='none';bookingsModal.setAttribute('aria-hidden','true')}
      }
    });
  </script>
</body>
</html>
